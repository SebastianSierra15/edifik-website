{
  "app": {
    "api": {
      "auth": {
        "[...nextauth]": {
          "route.ts": "import { authOptions } from \"@/lib/auth\";\nimport NextAuth from \"next-auth\";\n\nconst handler = NextAuth(authOptions);\nexport { handler as GET, handler as POST };\n"
        }
      },
      "user": {
        "route.ts": "import { NextResponse } from \"next/server\";\r\nimport { db } from \"@/lib/db\";\r\nimport { ProjectSummary } from \"@/lib/definitios\";\r\nimport { RowDataPacket } from \"mysql2\";\r\nimport { getServerSession } from \"next-auth\";\r\nimport { authOptions } from \"@/lib/auth\";\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const session = await getServerSession(authOptions);\r\n    if (!session) {\r\n      return NextResponse.json({ error: \"No autenticado\" }, { status: 401 });\r\n    }\r\n\r\n    const userId = parseInt(session?.user?.id ?? \"0\", 10);\r\n    const url = new URL(req.url);\r\n    const searchParams = url.searchParams;\r\n\r\n    const page = parseInt(searchParams.get(\"page\") || \"1\", 10);\r\n    const pageSize = parseInt(searchParams.get(\"pageSize\") || \"10\", 10);\r\n    const statusProject = parseInt(\r\n      searchParams.get(\"statusProject\") || \"2\",\r\n      10\r\n    );\r\n    const validatedPage = page > 0 ? page : 1;\r\n    const validatedPageSize = pageSize > 0 ? pageSize : 16;\r\n\r\n    const [result] = await db.query<RowDataPacket[][]>(\r\n      \"CALL get_user_projects(?, ?, ?, ?)\",\r\n      [userId, validatedPage, validatedPageSize, statusProject]\r\n    );\r\n\r\n    const [projectsRows = [], projectMediaRows = [], [totalEntriesRow] = []] =\r\n      result;\r\n    const totalEntries = totalEntriesRow?.totalEntries || 0;\r\n\r\n    const projectMediaMap: Record<\r\n      number,\r\n      { url: string; tag: string; projectId: number }[]\r\n    > = {};\r\n    projectMediaRows.forEach((media: any) => {\r\n      if (!projectMediaMap[media.projectId]) {\r\n        projectMediaMap[media.projectId] = [];\r\n      }\r\n      projectMediaMap[media.projectId].push({\r\n        url: media.url,\r\n        tag: media.tag,\r\n        projectId: media.projectId,\r\n      });\r\n    });\r\n\r\n    const projects: ProjectSummary[] = projectsRows.map((row: any) => ({\r\n      id: row.id,\r\n      name: row.name,\r\n      price: row.price || null,\r\n      totalArea: row.area,\r\n      bedrooms: row.bedrooms || null,\r\n      bathrooms: row.bathrooms || null,\r\n      parkingSpots: row.parkingSpots || null,\r\n      longitude: row.longitude as number,\r\n      latitude: row.latitude as number,\r\n      address: row.address,\r\n      city: {\r\n        id: row.cityId,\r\n        name: row.cityName,\r\n        departament: {\r\n          id: row.departamentId,\r\n          name: row.departamentName,\r\n        },\r\n      },\r\n      projectMedia: projectMediaMap[row.id] || [],\r\n    }));\r\n\r\n    return NextResponse.json({ projects, totalEntries });\r\n  } catch (error) {\r\n    console.error(\"Error al obtener proyectos del usuario:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Fallo al obtener proyectos del usuario\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function DELETE(req: Request) {\r\n  const session = await getServerSession(authOptions);\r\n\r\n  if (!session) {\r\n    return NextResponse.json({ error: \"No autenticado\" }, { status: 401 });\r\n  }\r\n\r\n  const permissions = session?.user?.permissions;\r\n\r\n  const hasPermission = permissions?.some(\r\n    (perm) => perm.name === \"Gestionar propiedades propias\"\r\n  );\r\n\r\n  if (!hasPermission) {\r\n    return NextResponse.json({ error: \"Acceso denegado\" }, { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const userId = session.user.id;\r\n\r\n    const url = new URL(req.url);\r\n    const projectId = parseInt(url.searchParams.get(\"id\") || \"\", 10);\r\n\r\n    if (!projectId) {\r\n      return NextResponse.json(\r\n        { error: \"ID del proyecto no proporcionado o inválido.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await db.query(\"CALL delete_user_project(?, ?)\", [projectId, userId]);\r\n\r\n    const response = NextResponse.json(\r\n      { message: \"Proyecto eliminado correctamente.\" },\r\n      { status: 200 }\r\n    );\r\n\r\n    return response;\r\n  } catch (error) {\r\n    console.error(\"Error al eliminar el proyecto:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Error al eliminar el proyecto.\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"
      }
    }
  },
  "lib": {
    "auth.ts": "import { NextAuthOptions } from \"next-auth\";\nimport { db } from \"@/lib/db\";\nimport GoogleProvider from \"next-auth/providers/google\";\nimport { RowDataPacket } from \"mysql2\";\nimport { Permission } from \"./definitios\";\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID || \"\",\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\n    }),\n  ],\n  secret: process.env.AUTH_SECRET,\n  pages: {\n    signIn: \"/login\",\n  },\n  callbacks: {\n    async jwt({ token, user, account }) {\n      if (account?.provider === \"google\" && user && !token.id) {\n        const { email, name, image } = user;\n\n        const [result] = await db.query<RowDataPacket[][]>(\n          \"CALL get_user_session(?)\",\n          [email]\n        );\n\n        let [userRows = [], permissionsRows = []] = result;\n\n        if (userRows.length === 0) {\n          const [resultInsert] = await db.query<RowDataPacket[][]>(\n            \"CALL insert_user_provider(?, ?, ?, ?)\",\n            [name, email, image, \"Google\"]\n          );\n\n          [userRows = [], permissionsRows = []] = resultInsert;\n        }\n\n        const permissions: Permission[] = permissionsRows.map(\n          ({ id, name }) => ({ id, name })\n        );\n\n        token.id = userRows[0].id?.toString() || \"\";\n        token.membershipId = userRows[0].membershipId?.toString() || \"\";\n        token.role = userRows[0].role?.toString() || \"\";\n        token.permissions = permissions || [];\n      }\n\n      if (!token.permissions) {\n        token.permissions = [];\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      session.user.id = token.id?.toString() || \"\";\n      session.user.membershipId = token.membershipId?.toString() || \"\";\n      session.user.role = token.role?.toString() || \"\";\n      session.user.permissions = (token.permissions as Permission[]) || [];\n\n      return session;\n    },\n  },\n  debug: process.env.AUTH_DEBUG === \"true\",\n};\n",
    "db.ts": "import mysql from \"mysql2/promise\";\n\nexport const db = mysql.createPool({\n  host: process.env.DB_HOST,\n  user: process.env.DB_USER,\n  password: process.env.DB_PASSWORD,\n  database: process.env.DB_NAME,\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n});\n",
    "definitios.ts": "import { DateTime } from \"next-auth/providers/kakao\";\n\nexport type ColumnType =\n  | \"string\"\n  | \"number\"\n  | \"boolean\"\n  | \"date\"\n  | \"array\"\n  | \"status\";\n\nexport interface Header<T> {\n  label: string;\n  key: keyof T | string;\n  type: ColumnType;\n  subKey?: string;\n  statusMapping?: Record<string, { label: string; className: string }>;\n}\n\nexport interface User {\n  id: number;\n  identityDocument?: string;\n  names?: string;\n  lastnames?: string;\n  birthdate?: Date;\n  email: string;\n  phoneNumber?: string;\n  gender?: Gender;\n  password?: string;\n  state?: boolean;\n  registrationDate?: DateTime;\n  lastLogin?: DateTime;\n  role: Role;\n  membership: MembershipSummary;\n  provider: string;\n  totalProperties?: number;\n}\n\nexport interface Gender {\n  id: number;\n  name: string;\n}\n\nexport interface Role {\n  id: number;\n  name: string;\n  permissions?: Permission[];\n}\n\nexport interface Category {\n  id: number;\n  name: string;\n}\n\nexport interface CommonArea {\n  id: number;\n  name: string;\n}\n\nexport interface HousingType {\n  id: number;\n  name: string;\n}\n\nexport interface NearbyService {\n  id: number;\n  name: string;\n}\n\nexport interface Departament {\n  id: number;\n  name: string;\n}\n\nexport interface City {\n  id: number;\n  name: string;\n  departament: Departament;\n}\n\nexport interface PaymentMethod {\n  id: number;\n  name: string;\n  state: boolean;\n}\n\nexport interface Project {\n  id: number;\n  name: string;\n  state: boolean;\n  price?: number;\n  totalArea: number;\n  builtArea: number;\n  freeHeight?: number;\n  width?: number;\n  length?: number;\n  parkingSpots?: number;\n  elevator?: boolean;\n  heavyParking?: number;\n  availableUnits: number;\n  bathrooms?: number;\n  bedrooms?: number;\n  lobbies?: number;\n  towers?: number;\n  storageUnits?: number;\n  socioeconomicLevel?: number;\n  floorNumber?: number;\n  yearBuilt?: number;\n  customizationOptions?: boolean;\n  terrace?: boolean;\n  balcony?: boolean;\n  garden?: boolean;\n  laundryArea?: boolean;\n  complexName?: string;\n  shortDescription: string;\n  detailedDescription: string;\n  address: string;\n  latitude: number;\n  longitude: number;\n  availableDate?: Date;\n  projectType?: projectType;\n  statusProject?: statusProject;\n  propertyType: propertyType;\n  housingType?: HousingType;\n  city: City;\n  membership: number;\n  commonAreas: CommonArea[];\n  ownerId?: number;\n  email?: string;\n  residentialProjectId?: number;\n  warehouseProjectId?: number;\n  nearbyServices: NearbyService[];\n  projectMedia: ProjectMedia[];\n  media?: Media[];\n}\n\nexport interface projectType {\n  id: number;\n  name: string;\n}\n\nexport interface propertyType {\n  id: number;\n  name: string;\n}\n\nexport interface statusProject {\n  id: number;\n  name: string;\n}\n\nexport interface Membership {\n  id: number;\n  name: string;\n  benefits: string;\n  price: number;\n  discountThreeMonths: number;\n  discountSixMonths: number;\n  discountTwelveMonths: number;\n  maxProjects: number;\n  projectsFeatured: number;\n}\n\nexport interface Permission {\n  id: number;\n  name: string;\n}\n\nexport interface ImageType {\n  id: number;\n  name: string;\n  description?: string;\n  maxImagesAllowed: number;\n  isRequired: boolean;\n}\n\nexport interface ProjectMedia {\n  id?: number;\n  url: string;\n  tag: string;\n  description?: string;\n  projectId: number;\n  commonArea?: number;\n  imageType?: number;\n  type?: string;\n}\n\nexport interface Media {\n  id?: string;\n  tag: string;\n  file: File | string;\n  description?: string;\n  idType: number;\n  type: string;\n  category: string;\n}\n\nexport interface Request {\n  id: number;\n  date: Date;\n  operation: string;\n  responseMessage?: string;\n  userId: number;\n  userEmail: string;\n  statusRequestName: string;\n  projectId: number;\n  projectName: string;\n}\n\nexport interface ProjectView {\n  id: number;\n  name: string;\n  cityName: string;\n  price?: number;\n  area?: number;\n  bathrooms?: number;\n  parkingSpots?: number;\n  bedrooms?: number;\n  longitude?: number;\n  latitude?: number;\n  images: ProjectMedia[];\n}\n\nexport type ProjectData = Partial<Project>;\nexport type UserData = Partial<User>;\n\nexport type ProjectSummary = Pick<\n  Project,\n  | \"id\"\n  | \"name\"\n  | \"price\"\n  | \"totalArea\"\n  | \"bedrooms\"\n  | \"bathrooms\"\n  | \"parkingSpots\"\n  | \"address\"\n  | \"longitude\"\n  | \"latitude\"\n  | \"city\"\n  | \"projectMedia\"\n  | \"email\"\n>;\n\nexport type MembershipSummary = Pick<Membership, \"id\" | \"name\">;\n\nexport type ProjectMediaData = Partial<ProjectMedia>;\n",
    "email": {
      "sendEmail.ts": "import nodemailer from \"nodemailer\";\r\n\r\nexport async function sendEmail(\r\n  to: string,\r\n  subject: string,\r\n  htmlContent: string\r\n) {\r\n  try {\r\n    const transporter = nodemailer.createTransport({\r\n      service: \"gmail\",\r\n      auth: {\r\n        user: process.env.EMAIL_USER,\r\n        pass: process.env.EMAIL_PASS,\r\n      },\r\n    });\r\n\r\n    const mailOptions = {\r\n      from: `\"EdifiK\" <${process.env.EMAIL_USER}>`,\r\n      to,\r\n      subject,\r\n      html: htmlContent,\r\n    };\r\n\r\n    await transporter.sendMail(mailOptions);\r\n  } catch (error) {\r\n    console.error(\"❌ Error al enviar el correo:\", error);\r\n  }\r\n}\r\n"
    },
    "middleware": {
      "withPath.ts": "import { NextResponse } from \"next/server\";\r\n\r\nexport function withPath(\r\n  response: NextResponse,\r\n  pathname: string\r\n): NextResponse {\r\n  response.headers.set(\"x-pathname\", pathname);\r\n  return response;\r\n}\r\n"
    },
    "s3.ts": "import { S3Client } from \"@aws-sdk/client-s3\";\n\nexport const s3 = new S3Client({\n  region: process.env.AWS_BUCKET_REGION,\n  credentials: {\n    accessKeyId: process.env.AWS_ACCESS_KEY as string,\n    secretAccessKey: process.env.AWS_SECRET_KEY as string,\n  },\n});\n"
  }
}